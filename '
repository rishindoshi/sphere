var mongoose = require('mongoose');
var Vendor = require('../models/vendor');
var venueClient = require('./venues/venue');
var spotify = require('./spotify');

var getVendor = function(req, res) {
  Vendor.find({ spotifyUserId: req.query.spotifyUserId })
    .then(function(vendor) {
      res.json(vendor);
    })
    .catch(function(err) {
      res.send(err);
    });
}

// TODO: When a new vendor is created, we need to either
// create a new corresponding venue for that vendor, or
// if the venue already exists, add the new vendors genres
// to the already existing venue
var postVendor = function(req, res) {
  spotify.getUserGenres(req.body.spotifyUserId)
    .then(function(genres) {
      var temp = req.body;
      temp.musicTaste = genres;
      var newVendor = new Vendor(info);
      return newVendor.save();
    })
    .then(function(vendor) {
      res.send(vendor);
    })
    .catch(function(err) {
      res.send(err);
    });
}

module.exports = { getVendor, postVendor };

